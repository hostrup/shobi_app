<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Fiori Prototype - JSP Plan</title>
    <script
        id="sap-ui-bootstrap"
        src="https://ui5.sap.com/resources/sap-ui-core.js"
        data-sap-ui-theme="sap_horizon"
        data-sap-ui-libs="sap.m, sap.ui.core"
        data-sap-ui-compatVersion="edge"
        data-sap-ui-async="true">
    </script>
    <!-- Main application script -->
    <script>
        sap.ui.getCore().attachInit(function () {
            "use strict";

            sap.ui.require([
                "sap/ui/core/mvc/Controller",
                "sap/ui/model/json/JSONModel",
                "sap/ui/core/mvc/XMLView"
            ], function (Controller, JSONModel, XMLView) {

                // 1. Define the Controller Class
                var AppController = Controller.extend("jsp.prototype.controller.App", {
                    onInit: function() {
                        var oPlanData = {
                            strækninger: [
                                {
                                    fra: "Næstved",
                                    til: "Nykøbing F Vest",
                                    stationer: [ {navn: "Lundby"}, {navn: "Vordingborg"} ],
                                    mellemStationer: [ {fra: "Lundby", til: "Masnedø"} ]
                                },
                                {
                                    fra: "Vigerslev",
                                    til: "Ringsted",
                                    stationer: [],
                                    mellemStationer: [
                                        {fra: "Vigerslev", til: "Jersie Fjern"},
                                        {fra: "Jersie Fjern", til: "Køge"},
                                        {fra: "Lellinge", til: "Bjæverskov"}
                                    ]
                                },
                                {
                                    fra: "Ålborg",
                                    til: "Frederikshavn",
                                    stationer: [
                                        {navn: "Aalborg"}, {navn: "Lindholm"}, {navn: "Brønderslev"},
                                        {navn: "Vrå"}, {navn: "Hjørring"}, {navn: "Sindbjerg"},
                                        {navn: "Tolne"}, {navn: "Kvissel"}, {navn: "Frederikshavn"}
                                    ],
                                    mellemStationer: []
                                },
                                {
                                    fra: "Roskilde",
                                    til: "Næstved",
                                    stationer: [],
                                    mellemStationer: []
                                }
                            ]
                        };
                        var oModel = new JSONModel(oPlanData);
                        this.getView().setModel(oModel, "planModel");
                    }
                });

                // 2. Create an instance of the Controller
                var oAppController = new AppController();

                // 3. Define the XML View as a string, using only sap.m controls
                var sXMLView = `
                    <mvc:View
                        xmlns:mvc="sap.ui.core.mvc"
                        xmlns="sap.m"
                        xmlns:core="sap.ui.core"
                        displayBlock="true">
                        <Page title="JSP Plan Koncept" showHeader="false">
                            <content>
                                <VBox height="100vh" width="100%" alignItems="Center" justifyContent="Center" class="sapUiSmallMargin">
                                    <Panel class="sapUiMediumMargin" width="80rem">
                                        <headerToolbar>
                                            <Toolbar>
                                                <VBox>
                                                    <Title text="Jernbanearbejde ved bro" level="H1"/>
                                                    <Text text="2025-00002-002" class="sapUiTinyMarginTop"/>
                                                </VBox>
                                                <ToolbarSpacer />
                                                <HBox>
                                                    <ObjectStatus title="Status" text="Godkendt" state="Success" class="sapUiSmallMarginEnd"/>
                                                    <ObjectStatus title="Gyldig fra" text="01.07.2025" state="None" icon="sap-icon://calendar" />
                                                </HBox>
                                            </Toolbar>
                                        </headerToolbar>
                                        <content>
                                            <List
                                                id="straekningList"
                                                items="{planModel>/strækninger}"
                                                noDataText="Ingen strækninger tilføjet">
                                                <CustomListItem templateShareable="false">
                                                    <VBox class="sapUiSmallMargin sapBackgroundColorNeutral">
                                                        <HBox alignItems="Center" class="sapUiSmallMarginBegin sapUiTinyMarginTopBottom">
                                                            <Label text="Strækning" design="Bold" class="sapUiTinyMarginEnd"/>
                                                            <HBox class="sapUiTinyMarginEnd" alignItems="Center">
                                                                <Text text="{planModel>fra}" class="sapMTitle" />
                                                                <core:Icon src="sap-icon://arrow-right" class="sapUiTinyMarginBeginEnd"/>
                                                                <Text text="{planModel>til}" class="sapMTitle" />
                                                            </HBox>
                                                        </HBox>
                                                        <core:HTML content='&lt;hr style=&quot;border: 0; border-top: 1px dashed #d9d9d9; margin: 0.5rem 0;&quot; /&gt;' />
                                                        <VBox class="sapUiSmallMarginBegin sapUiSmallMarginBottom">
                                                            <!-- Stationer Section -->
                                                            <VBox visible="{= \${planModel>stationer}.length > 0 }">
                                                                <Label text="Stationer" design="Bold" class="sapUiTinyMarginBottom"/>
                                                                <FlexBox wrap="Wrap" items="{planModel>stationer}">
                                                                    <GenericTag text="{planModel>navn}" class="sapUiTinyMargin" templateShareable="false"/>
                                                                </FlexBox>
                                                            </VBox>
                                                            <!-- Mellem Stationer Section -->
                                                            <VBox visible="{= \${planModel>mellemStationer}.length > 0 }" class="sapUiSmallMarginTop">
                                                                <Label text="Mellem Stationer" design="Bold" class="sapUiTinyMarginBottom"/>
                                                                <VBox items="{planModel>mellemStationer}">
                                                                   <Panel backgroundDesign="Transparent" class="sapUiNoContentPadding" templateShareable="false">
                                                                        <HBox alignItems="Center">
                                                                            <Text text="{planModel>fra}"/>
                                                                            <core:HTML content='&lt;div style=&quot;flex-grow: 1; border-bottom: 1px dashed #888; margin: 0 0.5rem;&quot;&gt;&lt;/div&gt;' />
                                                                            <Text text="{planModel>til}"/>
                                                                        </HBox>
                                                                   </Panel>
                                                                </VBox>
                                                            </VBox>
                                                            <Text
                                                                text="Ingen stationer eller mellem stationer valgt."
                                                                visible="{= !\${planModel>stationer}.length &amp;&amp; !\${planModel>mellemStationer}.length }" 
                                                                class="sapUiItalicElement"/>
                                                        </VBox>
                                                    </VBox>
                                                </CustomListItem>
                                            </List>
                                        </content>
                                    </Panel>
                                </VBox>
                            </content>
                        </Page>
                    </mvc:View>
                `;

                // 4. Create the XML View and pass the controller instance directly
                XMLView.create({
                    definition: sXMLView,
                    controller: oAppController 
                }).then(function (oView) {
                    oView.placeAt("content");
                });
            });
        });
    </script>
</head>
<body class="sapUiBody" id="content">
</body>
</html>
