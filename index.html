<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>Parfume Klon Finder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root {
            --primary: #0077cc;
            --bg: #f7f7f7;
            --card: #fff;
            --text: #222;
            --accent: #eab308;
            --shadow: 0 2px 8px #0001;
        }
        [data-theme="dark"] {
            --primary: #60a5fa;
            --bg: #18181b;
            --card: #23232b;
            --text: #f3f3f3;
            --accent: #facc15;
            --shadow: 0 2px 8px #0005;
        }
        html, body { height: 100%; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: var(--bg); color: var(--text); min-height: 100vh; }
        header { background: var(--primary); color: #fff; padding: 1.2em 0 1em 0; text-align: center; box-shadow: var(--shadow);}
        .container { max-width: 900px; margin: auto; padding: 1em; }
        .filters, .actions { display: flex; flex-wrap: wrap; gap: 0.5em; margin-bottom: 1em; }
        .filters > * { flex: 1 1 120px; min-width: 120px; }
        .actions { justify-content: flex-end; align-items: center; }
        input, select, button { padding: 0.5em; border-radius: 5px; border: 1px solid #ccc; font-size: 1em; }
        button { background: var(--primary); color: #fff; border: none; cursor: pointer; transition: background 0.2s; }
        button:active { background: #005fa3; }
        .theme-toggle { background: none; border: none; font-size: 1.5em; margin-left: 1em; color: var(--accent); cursor: pointer; }
        .parfume-list { display: flex; flex-direction: column; gap: 1em; }
        .parfume { background: var(--card); border-radius: 12px; box-shadow: var(--shadow); padding: 1em; display: flex; flex-direction: column; gap: 0.5em; transition: box-shadow 0.2s; }
        .parfume:hover { box-shadow: 0 4px 16px #0002; }
        .parfume .row { display: flex; flex-wrap: wrap; gap: 1em; align-items: center; }
        .brand { font-weight: bold; font-size: 1.1em; letter-spacing: 0.5px; }
        .fav-btn { background: none; border: none; font-size: 1.5em; cursor: pointer; color: var(--accent); }
        .fav-btn.fav { color: var(--accent); }
        .fav-btn:not(.fav) { color: #bbb; }
        .links a { margin-right: 1em; color: var(--primary); text-decoration: none; font-weight: 500; }
        .links a:hover { text-decoration: underline; }
        .sort-btn { background: none; border: none; color: var(--primary); font-size: 1em; cursor: pointer; margin-left: 0.2em; }
        .sort-btn.active { font-weight: bold; }
        @media (max-width: 600px) {
            .filters, .actions { flex-direction: column; }
            .parfume .row { flex-direction: column; align-items: flex-start; }
            .container { padding: 0.5em; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Parfume Klon Finder</h1>
        <small>Find kloner, filtrér, sorter og gem favoritter – mobilvenlig!</small>
        <button class="theme-toggle" id="themeToggle" title="Skift lys/mørk">🌙</button>
    </header>
    <div class="container">
        <div class="actions">
            <button id="showFavsBtn">Vis kun favoritter</button>
            <button id="resetFavsBtn">Nulstil favoritter</button>
        </div>
        <div class="filters">
            <select id="brandFilter"><option value="">Brand</option></select>
            <select id="catFilter"><option value="">Kategori</option></select>
            <select id="typeFilter"><option value="">Duftfamilie</option></select>
            <select id="confFilter"><option value="">Sikkerhed</option></select>
            <input type="text" id="searchInput" placeholder="Fritekstsøgning...">
        </div>
        <div class="actions" style="justify-content: flex-start; margin-bottom: 0;">
            <span>Sortér efter:</span>
            <button class="sort-btn" data-sort="brand">Brand</button>
            <button class="sort-btn" data-sort="cat">Kategori</button>
            <button class="sort-btn" data-sort="scentType">Duftfamilie</button>
            <button class="sort-btn" data-sort="confidence">Sikkerhed</button>
            <button class="sort-btn" data-sort="INSPIRED BY">Navn</button>
        </div>
        <div class="parfume-list" id="results"></div>
    </div>
    <script>
        let parfumeData = {};
        let flatList = [];
        let favorites = JSON.parse(localStorage.getItem('parfumeFavs') || '[]');
        let showOnlyFavs = false;
        let sortKey = null, sortDir = 1;

        // Lys/mørk mode
        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            document.getElementById('themeToggle').textContent = theme === 'dark' ? '☀️' : '🌙';
        }
        document.getElementById('themeToggle').onclick = function() {
            setTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        };
        // Init theme
        setTheme(localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));

        // Utility: Flatter JSON til liste
        function flattenData(data) {
            let arr = [];
            Object.entries(data).forEach(([brand, cats]) => {
                Object.entries(cats).forEach(([cat, parfumes]) => {
                    parfumes.forEach(p => arr.push({...p, brand, cat}));
                });
            });
            return arr;
        }
        function uniq(arr) { return [...new Set(arr)].sort(); }

        // Filtrering og sortering
        function getFilteredList() {
            let list = flatList;
            const brand = document.getElementById('brandFilter').value;
            const cat = document.getElementById('catFilter').value;
            const type = document.getElementById('typeFilter').value;
            const conf = document.getElementById('confFilter').value;
            const search = document.getElementById('searchInput').value.trim().toLowerCase();

            if (brand) list = list.filter(p => p.brand === brand);
            if (cat) list = list.filter(p => p.cat === cat);
            if (type) list = list.filter(p => (p.scentType||'').toLowerCase() === type.toLowerCase());
            if (conf) list = list.filter(p => (p.confidence||'').toLowerCase() === conf.toLowerCase());
            if (search) {
                list = list.filter(p =>
                    [p.brand, p.cat, p["INSPIRED BY"], p.CODE, p.scentType, p.notes, p.shortDesc]
                    .map(x => (x||'').toLowerCase()).some(x => x.includes(search))
                );
            }
            if (showOnlyFavs) list = list.filter(p => favorites.includes(p.CODE));
            if (sortKey) list = list.sort((a, b) => (a[sortKey]||'').localeCompare(b[sortKey]||'') * sortDir);
            return list;
        }

        // Opdater filter-dropdowns
        function updateFilters() {
            const brands = uniq(flatList.map(p => p.brand));
            const cats = uniq(flatList.map(p => p.cat));
            const types = uniq(flatList.map(p => p.scentType));
            const confs = uniq(flatList.map(p => p.confidence));
            const setOpts = (el, arr, label) => {
                el.innerHTML = `<option value="">${label}</option>` + arr.map(x => `<option value="${x}">${x}</option>`).join('');
            };
            setOpts(document.getElementById('brandFilter'), brands, 'Brand');
            setOpts(document.getElementById('catFilter'), cats, 'Kategori');
            setOpts(document.getElementById('typeFilter'), types, 'Duftfamilie');
            setOpts(document.getElementById('confFilter'), confs, 'Sikkerhed');
        }

        // Render parfumer
        function render() {
            let list = getFilteredList();
            const results = document.getElementById('results');
            if (!list.length) { results.innerHTML = "<i>Ingen resultater.</i>"; return; }
            results.innerHTML = list.map(p => `
                <div class="parfume">
                    <div class="row">
                        <span class="brand">${p.brand} (${p.cat})</span>
                        <button class="fav-btn${favorites.includes(p.CODE) ? ' fav' : ''}" title="Favorit" onclick="toggleFav('${p.CODE}')">
                            ${favorites.includes(p.CODE) ? '★' : '☆'}
                        </button>
                    </div>
                    <div><b>Inspired by:</b> ${p["INSPIRED BY"]}</div>
                    <div><b>CODE:</b> https://leparfum.com.gr/en/module/iqitsearch/searchiqit?s=${encodeURIComponent(p.CODE)}</div>
                    <div><b>Type:</b> ${p.scentType}</div>
                    <div><b>Noter:</b> ${p.notes}</div>
                    <div><b>Kilde:</b> ${p.notesSource}</div>
                    <div><b>Sikkerhed:</b> ${p.confidence}</div>
                    <div><b>Beskrivelse:</b> ${p.shortDesc}</div>
                    <div class="links">
                        https://leparfum.com.gr/en/module/iqitsearch/searchiqit?s=${encodeURIComponent(p.CODE)}
                        https://shobi.dk/search?q=${encodeURIComponent(p['INSPIRED BY'])}
                    </div>
                </div>
            `).join('');
        }

        // Favorit-funktion
        window.toggleFav = function(code) {
            if (favorites.includes(code)) favorites = favorites.filter(c => c !== code);
            else favorites.push(code);
            localStorage.setItem('parfumeFavs', JSON.stringify(favorites));
            render();
        };

        // Vis kun favoritter
        document.getElementById('showFavsBtn').onclick = function() {
            showOnlyFavs = !showOnlyFavs;
            this.textContent = showOnlyFavs ? "Vis alle" : "Vis kun favoritter";
            render();
        };

        // Nulstil favoritter
        document.getElementById('resetFavsBtn').onclick = function() {
            if (confirm("Vil du fjerne alle favoritter?")) {
                favorites = [];
                localStorage.setItem('parfumeFavs', '[]');
                render();
            }
        };

        // Filtre og søgning
        ['brandFilter','catFilter','typeFilter','confFilter','searchInput'].forEach(id => {
            document.getElementById(id).oninput = () => render();
        });

        // Sortering
        document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.onclick = function() {
                if (sortKey === this.dataset.sort) sortDir *= -1;
                else { sortKey = this.dataset.sort; sortDir = 1; }
                document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                render();
            };
        });

        // Automatisk load fra server
        fetch('Parfumer_beriget_AI.json').then(r => r.json()).then(data => {
            parfumeData = data;
            flatList = flattenData(parfumeData);
            updateFilters();
            render();
        }).catch(()=>{document.getElementById('results').innerHTML = "<b>Kunne ikke loade parfume-data.</b>";});
    </script>
</body>
</html>
