
<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <title>Parfume Klon Finder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: #f7f7f7; }
        header { background: #222; color: #fff; padding: 1em; text-align: center; }
        .container { max-width: 900px; margin: auto; padding: 1em; }
        .filters, .actions { display: flex; flex-wrap: wrap; gap: 0.5em; margin-bottom: 1em; }
        .filters > * { flex: 1 1 120px; min-width: 120px; }
        .actions { justify-content: flex-end; }
        input, select, button { padding: 0.5em; border-radius: 5px; border: 1px solid #ccc; }
        button { background: #0077cc; color: #fff; border: none; cursor: pointer; }
        button:active { background: #005fa3; }
        .parfume-list { display: flex; flex-direction: column; gap: 1em; }
        .parfume { background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #0001; padding: 1em; display: flex; flex-direction: column; gap: 0.5em; }
        .parfume .row { display: flex; flex-wrap: wrap; gap: 1em; align-items: center; }
        .brand { font-weight: bold; font-size: 1.1em; }
        .fav-btn { background: none; border: none; font-size: 1.5em; cursor: pointer; color: #eab308; }
        .fav-btn.fav { color: #eab308; }
        .fav-btn:not(.fav) { color: #bbb; }
        .links a { margin-right: 1em; color: #0077cc; text-decoration: none; }
        .links a:hover { text-decoration: underline; }
        @media (max-width: 600px) {
            .filters, .actions { flex-direction: column; }
            .parfume .row { flex-direction: column; align-items: flex-start; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Parfume Klon Finder</h1>
        <small>Find kloner, filtrér, sorter og gem favoritter – mobilvenlig!</small>
    </header>
    <div class="container">
        <div class="actions">
            <input type="file" id="fileInput" accept=".json">
            <button id="showFavsBtn">Vis kun favoritter</button>
            <button id="resetFavsBtn">Nulstil favoritter</button>
        </div>
        <div class="filters">
            <select id="brandFilter"><option value="">Brand</option></select>
            <select id="catFilter"><option value="">Kategori</option></select>
            <select id="typeFilter"><option value="">Duftfamilie</option></select>
            <select id="confFilter"><option value="">Sikkerhed</option></select>
            <input type="text" id="searchInput" placeholder="Fritekstsøgning...">
        </div>
        <div class="parfume-list" id="results"></div>
    </div>
    <script>
        let parfumeData = {};
        let flatList = [];
        let favorites = JSON.parse(localStorage.getItem('parfumeFavs') || '[]');
        let showOnlyFavs = false;

        // Utility: Flatter JSON til liste
        function flattenData(data) {
            let arr = [];
            Object.entries(data).forEach(([brand, cats]) => {
                Object.entries(cats).forEach(([cat, parfumes]) => {
                    parfumes.forEach(p => arr.push({...p, brand, cat}));
                });
            });
            return arr;
        }

        // Utility: Unik liste
        function uniq(arr) { return [...new Set(arr)].sort(); }

        // Load JSON fra fil
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(evt) {
                parfumeData = JSON.parse(evt.target.result);
                flatList = flattenData(parfumeData);
                updateFilters();
                render();
            };
            reader.readAsText(file);
        });

        // Filtrering og sortering
        function getFilteredList() {
            let list = flatList;
            const brand = document.getElementById('brandFilter').value;
            const cat = document.getElementById('catFilter').value;
            const type = document.getElementById('typeFilter').value;
            const conf = document.getElementById('confFilter').value;
            const search = document.getElementById('searchInput').value.trim().toLowerCase();

            if (brand) list = list.filter(p => p.brand === brand);
            if (cat) list = list.filter(p => p.cat === cat);
            if (type) list = list.filter(p => (p.scentType||'').toLowerCase() === type.toLowerCase());
            if (conf) list = list.filter(p => (p.confidence||'').toLowerCase() === conf.toLowerCase());
            if (search) {
                list = list.filter(p =>
                    [p.brand, p.cat, p["INSPIRED BY"], p.CODE, p.scentType, p.notes, p.shortDesc]
                    .map(x => (x||'').toLowerCase()).some(x => x.includes(search))
                );
            }
            if (showOnlyFavs) list = list.filter(p => favorites.includes(p.CODE));
            return list;
        }

        // Opdater filter-dropdowns
        function updateFilters() {
            const brands = uniq(flatList.map(p => p.brand));
            const cats = uniq(flatList.map(p => p.cat));
            const types = uniq(flatList.map(p => p.scentType));
            const confs = uniq(flatList.map(p => p.confidence));
            const setOpts = (el, arr, label) => {
                el.innerHTML = `<option value="">${label}</option>` + arr.map(x => `<option value="${x}">${x}</option>`).join('');
            };
            setOpts(document.getElementById('brandFilter'), brands, 'Brand');
            setOpts(document.getElementById('catFilter'), cats, 'Kategori');
            setOpts(document.getElementById('typeFilter'), types, 'Duftfamilie');
            setOpts(document.getElementById('confFilter'), confs, 'Sikkerhed');
        }

        // Render parfumer
        function render(sortKey = null, sortDir = 1) {
            let list = getFilteredList();
            if (sortKey) list = list.sort((a, b) => (a[sortKey]||'').localeCompare(b[sortKey]||'') * sortDir);
            const results = document.getElementById('results');
            if (!list.length) { results.innerHTML = "<i>Ingen resultater.</i>"; return; }
            results.innerHTML = list.map(p => `
                <div class="parfume">
                    <div class="row">
                        <span class="brand">${p.brand} (${p.cat})</span>
                        <button class="fav-btn${favorites.includes(p.CODE) ? ' fav' : ''}" title="Favorit" onclick="toggleFav('${p.CODE}')">
                            ${favorites.includes(p.CODE) ? '★' : '☆'}
                        </button>
                    </div>
                    <div><b>Inspired by:</b> ${p["INSPIRED BY"]}</div>
                    <div><b>CODE:</b> https://leparfum.com.gr/en/module/iqitsearch/searchiqit?s=${encodeURIComponent(p.CODE)}</div>
                    <div><b>Type:</b> ${p.scentType}</div>
                    <div><b>Noter:</b> ${p.notes}</div>
                    <div><b>Kilde:</b> ${p.notesSource}</div>
                    <div><b>Sikkerhed:</b> ${p.confidence}</div>
                    <div><b>Beskrivelse:</b> ${p.shortDesc}</div>
                    <div class="links">
                        <a href="https://leparfum.com.gr/en/module/iqitsearch/searchiqit?s=${encodeURIComponent(p.CODE)}" target        <a href="https://shobi.dk/search?q=${encodeURIComponent(p['INSPIRED BY'])}" target="_blank">
                </div>
            `).join('');
        }

        // Favorit-funktion
        window.toggleFav = function(code) {
            if (favorites.includes(code)) favorites = favorites.filter(c => c !== code);
            else favorites.push(code);
            localStorage.setItem('parfumeFavs', JSON.stringify(favorites));
            render();
        };

        // Vis kun favoritter
        document.getElementById('showFavsBtn').onclick = function() {
            showOnlyFavs = !showOnlyFavs;
            this.textContent = showOnlyFavs ? "Vis alle" : "Vis kun favoritter";
            render();
        };

        // Nulstil favoritter
        document.getElementById('resetFavsBtn').onclick = function() {
            if (confirm("Vil du fjerne alle favoritter?")) {
                favorites = [];
                localStorage.setItem('parfumeFavs', '[]');
                render();
            }
        };

        // Filtre og søgning
        ['brandFilter','catFilter','typeFilter','confFilter','searchInput'].forEach(id => {
            document.getElementById(id).oninput = () => render();
        });

        // Sortering (klik på label for at sortere)
        // Kan udvides med sorteringsknapper hvis ønsket

        // Automatisk load hvis filen ligger på serveren
        fetch('Parfumer_beriget_AI.json').then(r => r.ok ? r.json() : null).then(data => {
            if (data) {
                parfumeData = data;
                flatList = flattenData(parfumeData);
                updateFilters();
                render();
            }
        }).catch(()=>{});

    </script>
</body>
</html>
